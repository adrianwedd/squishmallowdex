# v1.3 Sprint Design — Color Filtering, Saved Views, i18n

**Date:** 2026-02-23
**Target Release:** v1.3.0
**Features:** Color-based filtering, URL-based saved views (shareable), full i18n UI (en + es)

---

## Overview

Three sequential features, each shippable independently but layering on shared infrastructure:
1. **Color filtering** — multi-select colors from existing dataset field, AND semantics
2. **URL saved views** — shareable filter state encoded in hash (search + colors + sort)
3. **i18n UI + Spanish** — all UI chrome localized (buttons, labels, status text, disclosure)

---

## Feature 1 — Color Filtering

### Scope
Add a multi-select color chip filter to the toolbar. Colors extracted from the existing `Color` column in the dataset (comma-separated strings like "Pink, Blue").

### Color Parser Rules
- **Trim & normalize:** Remove leading/trailing whitespace, lowercase internally
- **Canonical colors:** "Pink", "Blue", "Green", "Orange", "Yellow", "Purple", "Red", "Grey", "White", "Black", "Tan", "Turquoise", "Lavender", "Rainbow", "Tie-dye", "Silver", "Cream"
- **Unknown colors:** Any unrecognized color in the data is grouped as "Other" (single fallback chip)
- **Deduplication:** Extract unique colors across all items; build chip list once at init

### Filter Semantics
- **Logic:** AND — only items matching *all* selected colors are shown
- **UI copy:** "Showing items with all selected colors"
- **Integration:** Colors combine cumulatively with existing search + favOnly + ownOnly filters

### Unknown Color Handling
- Unknown raw color strings collapse into a single "Other" chip
- "Other" is filterable (selecting it shows all items with unrecognized colors)
- Fallback chip style: gray background, neutral label

### Files
- `docs/squishmallowdex.html` — add color parser, color chip UI, filter integration

---

## Feature 2 — URL-Based Saved Views

### Shareable State
State encoded in URL hash (case-sensitive, canonical English values):
- `search` — search text
- `colors` — selected colors (comma-separated canonical names)
- `sortField` — field name (name, type, color, squad, size, collector, year) or "table" for default
- `sortDir` — "asc" or "desc"

**NOT shareable (excluded from hash):**
- `favOnly`, `ownOnly` — these depend on personal localStorage and don't sync across users
- `viewMode`, `cardSort`, `density` — personal UI preferences, stored in localStorage
- Favorites/owned state — personal data, stored in localStorage

### Hash Encoding Format
Use `URLSearchParams`-style encoding:
```
#search=cat&colors=Pink,Blue&sortField=name&sortDir=asc
```

Missing parameters use defaults (search="", colors=[], sortField="table", sortDir="asc").

### Precedence on Page Load
1. Parse URL hash if present
2. If hash missing, fall back to localStorage
3. Apply state before rendering data

### Hash → localStorage Sync
When user changes filters/sort via UI:
1. Update internal state
2. Update URL hash
3. DO NOT update localStorage filter state (localStorage only tracks personal prefs)

### Browser Back/Forward
Listen for `hashchange` event and re-apply state from new hash. Use guard variable `let isApplyingHashState = false` to prevent loops.

### Share Button
- Add "Copy link" button near filters
- Copies current URL with shareable state baked in
- Tooltip: "Share this link to show the current filtered view. Your personal favorites/owned items will not be visible to recipients."

### Files
- `docs/squishmallowdex.html` — URL encoding/decoding, hashchange listener, share button

---

## Feature 3 — i18n UI + Spanish

### Scope
UI chrome only — button labels, filter names, status text, aria-labels, footer disclosure.

**NOT localized:**
- Dataset content (Squishmallow names, bios, types, colors remain in English)
- Internal filter names (canonical English used everywhere internally)

### Canonical vs Localized Values
- **Internal/URL:** Always use canonical English (e.g., "Pink", "Table", "Compact")
- **Display labels:** Localized based on active language (e.g., "Rosa", "Tabla", "Compacto")
- **Language persistence:** Stored in localStorage (`squishdex-lang`, default "en")
- **Language change:** Only display labels update; hash values and internal state remain canonical

### String Coverage
- Button labels: "Table", "Cards", "Compact", "Columns", "Share", etc.
- Filter labels: "Search", "Favorites only", "I own it", colors
- Status text: "Loading cards…", "Showing X of Y", "X Squishmallows", result count
- aria-labels: "Favourite", "I own this", "Buy on Amazon", etc.
- Footer: FTC affiliate disclosure
- Placeholders: search input placeholder text

### Count/Status Text Pluralization
Use formatter functions for dynamic text (e.g., "1 Squishmallow" vs "5 Squishmallows"):
```js
i18n[currentLang].formatCount(count) // returns localized singular/plural
```

### Implementation Structure
```js
const i18n = {
  en: {
    buttons: { table: "Table", cards: "Cards", compact: "Compact", ... },
    filters: { search: "Search", favOnly: "Favorites only", ... },
    status: { loading: "Loading cards…", count: (n) => n === 1 ? "1 Squishmallow" : `${n} Squishmallows`, ... },
    colors: { pink: "Pink", blue: "Blue", ... },
    ...
  },
  es: {
    buttons: { table: "Tabla", cards: "Tarjetas", compact: "Compacto", ... },
    filters: { search: "Búsqueda", favOnly: "Solo favoritos", ... },
    status: { loading: "Cargando tarjetas…", count: (n) => n === 1 ? "1 Squishmallow" : `${n} Squishmallows`, ... },
    colors: { pink: "Rosa", blue: "Azul", ... },
    ...
  }
};

let currentLang = localStorage.getItem('squishdex-lang') || 'en';
document.documentElement.lang = currentLang;
```

### Language Switcher
- Dropdown or toggle button in toolbar (after Compact button)
- Shows current language, allows switching to other languages
- On change: update `currentLang`, `localStorage`, `document.documentElement.lang`, re-render all strings

### Files
- `docs/squishmallowdex.html` — i18n object, language switcher, string replacement in init + UI updates

---

## Integration & Testing

### Commit Order (Sequential)
1. **Commit 1:** Color filtering (Feature 1) + QA
2. **Commit 2:** URL saved views (Feature 2) + QA
3. **Commit 3:** i18n UI + Spanish (Feature 3) + QA

### Testing Per Feature
**Color filtering:**
- Select various color combinations, verify AND semantics
- Verify "Other" chip works for unknown colors
- Test in both table and card views
- Combine with search + favOnly + ownOnly

**URL saved views:**
- Set filters, copy link, open in new tab → state restored
- Share link with someone else (without your localStorage) — they see filtered results but not your personal favorites/owned state
- Use browser back/forward → hashchange restores correct state
- Language switch does not change hash values

**i18n UI + Spanish:**
- Toggle language → all UI strings change
- Language persists across reload
- Plural forms work correctly (1 vs many)
- aria-labels in active language
- URL hash values remain canonical (English)

### Phase Exit Rule
No known regressions in previously completed features after each commit.

---

## Out of Scope
- Dataset translation (bios, names, types remain English)
- Additional languages beyond Spanish (framework extensible for future)
- Color picker UI (only chip buttons)
- Advanced filter UI (no sliders, ranges, etc.)
- Save/load custom view names (only URL-based sharing)
